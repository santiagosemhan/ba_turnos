{% extends 'admin_base.html.twig' %}

{% set __title =  box %}

{% set __descripcion_opcional = sede %}

{% block content %}

    <div class="example-modal">
        <div style="float: right"><a class="btn btn-block btn-danger btn-sm" href="{{ path('app_box_cambiar_box') }}"> Cambiar Box</a></div>

        <div class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    {% if conTurno == true %}
                        <div class="modal-header">
                            <h4 class="modal-title">Turno:</h4>
                            <h2 class="modal-title" style="text-align: center"><b>{{ turno.turnoBox }}</b></h2>
                        </div>
                        <div class="modal-body">
                            <p>CUIT: <b>{{ turno.cuit }}</b></p>
                            <p>Nombre Completo: <b>{{ turno.nombreApellido }}</b></p>
                            <p>Tipo de Tramite: <b>{{ turno.tipoTramite }}</b></p>
                            <p>Hora Turno: <b>{{ turno.HoraTurnoString}}</b></p>
                        </div>
                        <div class="modal-footer">
                            {% if antendido == false %}
                            <a class="btn btn-warning pull-left" href="{{ path('app_box_volver_llamar_turno') }}"> Volver a Llamar</a>
                            <a class="btn btn-success" href="{{ path('app_box_turno_atendido', { 'id': turno.id }) }}"> Marcar como Atendido</a>
                            {% endif %}
                            <a class="btn btn-primary" href="{{ path('app_box_nuevo_turno') }}"> Llamar Proximo</a>
                        </div>
                    {% else %}
                        <div class="modal-header">
                            <h4 class="modal-title">Turno:</h4>
                        </div>
                        <div class="modal-body">
                            <p>Sin datos</p>
                        </div>
                        <div class="modal-footer">
                            <a class="btn btn-primary" href="{{ path('app_box_nuevo_turno') }}"> Llamar Proximo</a>
                        </div>
                    {% endif %}
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
    </div>

{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .example-modal .modal {
            position: relative;
            top: auto;
            bottom: auto;
            right: auto;
            left: auto;
            display: block;
            z-index: 1;
        }

        .example-modal .modal {
            background: transparent !important;
        }
    </style>
{% endblock %}

{% block footer_javascript %}
    {{ parent() }}
    <script>
        $('#adminbundle_turno_cuit').on('change', function(e) {
            if(validaCuit(document.getElementById("frontbundle_turno_cuit").value)){
                formularioSinError();
            }else{
                formularioConError();
                alert("El numero de cuit es incorrecto. Por favor verifiquelo");
            }

        });

        $('#adminbundle_turno_cuit').on('keypress', function(e) {
            tecla = (document.all) ? e.keyCode : e.which;
            //Tecla de retroceso para borrar, siempre la permite
            if (tecla==8){
                return true;
            }
            // Patron de entrada, en este caso solo acepta numeros
            patron =/[0-9]/;
            tecla_final = String.fromCharCode(tecla);
            return patron.test(tecla_final);
        });

        function formularioConError(){
            document.getElementsByClassName("btn btn-success")[0].disabled = true;
            var theDropDown = document.querySelector("#adminbundle_turno_cuit");
            theDropDown.classList.add("error_form");
        }

        function formularioSinError(){
            document.getElementsByClassName("btn btn-success")[0].disabled = false;
            var theDropDown = document.querySelector("#adminbundle_turno_cuit");
            theDropDown.classList.remove("error_form");
        }

        function validaCuit(sCUIT) {
            var aMult = '5432765432';
            var aMult = aMult.split('');

            if (sCUIT && sCUIT.length == 11) {
                aCUIT = sCUIT.split('');
                var iResult = 0;
                for(i = 0; i <= 9; i++) {
                    iResult += aCUIT[i] * aMult[i];
                }
                iResult = (iResult % 11);
                iResult = 11 - iResult;

                if (iResult == 11) iResult = 0;
                if (iResult == 10) iResult = 9;

                if (iResult == aCUIT[10]) {
                    return true;
                }
            }

            return false;
        }
    </script>
{% endblock %}

